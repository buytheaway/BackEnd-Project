<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Posts</title>
    <link rel="stylesheet" href="/css/profile.css">
</head>
<body>
    <header>
        <h1>All Posts</h1>
        <a href="/profile">Back to Profile</a>
        <form id="filterForm">
            <label for="tag">Filter by Tag:</label>
            <input type="text" id="tag" name="tag" placeholder="Enter tag">
            <label for="sort">Sort:</label>
            <select id="sort" name="sort">
                <option value="">Newest</option>
                <option value="oldest">Oldest</option>
            </select>
            <button type="submit">Apply</button>
        </form>
    </header>
    <main id="postsContainer">
        <!-- Posts will load here -->
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('filterForm');
            const postsContainer = document.getElementById('postsContainer');

            const loadPosts = (tag = '', sort = '') => {
                const query = new URLSearchParams();
                if (tag) query.append('tag', tag);
                if (sort) query.append('sort', sort);

                fetch(`/api/all-posts?${query.toString()}`)
                    .then(response => response.json())
                    .then(posts => {
                        postsContainer.innerHTML = ''; // Clear previous posts
                        posts.forEach(post => {
                            const postDiv = document.createElement('div');
                            postDiv.classList.add('post');
                            postDiv.innerHTML = `
                                <h3>${post.title}</h3>
                                <p>${post.content}</p>
                                <p><strong>Tags:</strong> ${post.tags.join(', ')}</p>
                                <p><em>By: ${post.author.username} (${post.author.email})</em></p>
                                <hr>
                            `;
                            postsContainer.appendChild(postDiv);
                        });
                    })
                    .catch(err => console.error('Error loading posts:', err));
            };

            // Load posts on page load
            loadPosts();

            // Filter form submission
            form.addEventListener('submit', event => {
                event.preventDefault();
                const tag = document.getElementById('tag').value;
                const sort = document.getElementById('sort').value;
                loadPosts(tag, sort);
            });
        });
    </script>
</body>
</html>